$schema: https://azuremlschemas.azureedge.net/latest/commandComponent.schema.json
type: command

name: extraction
display_name: Extraction
description: Extract images from pdfs
version: 0.0.1
is_deterministic: true

inputs:
  pdfs_input:
    type: uri_folder

outputs:
  images_output:
    type: uri_folder
  hash_output:
    type: uri_folder

environment:
  name: extraction_environment
  build:
    path: ./

additional_includes:
   - "../../packages"


code: ./

command: |
  set -euo pipefail

  python -m pip install --upgrade pip uv
  uv venv

  mkdir -p train/step

  # Copie tout sauf "packages" et "train"
  sh -c 'find . -mindepth 1 -maxdepth 1 \
      ! -name packages \
      ! -name train \
      -exec cp -a {} ./train/step/ \;'

  cd train/step

  UV_HTTP_TIMEOUT=300 uv sync --no-editable

  uv run python command.py \
    --pdfs_input ${{inputs.pdfs_input}} \
    --images_output ${{outputs.images_output}} \
    --hash_output ${{outputs.hash_output}}